#include <WiFi.h>
#include <WiFiClientSecure.h>
#include <UniversalTelegramBot.h>
const char* ssid = ""; //Nama penyedia hotspot
const char* password = ""; //Password nya
#define BOT_TOKEN ""   // token bot dari BotFather
#define CHAT_ID   ""     // chat id tujuan
WiFiClientSecure client;
UniversalTelegramBot bot(BOT_TOKEN, client);
#define buzzer 16 //Pin buzzer di ESP32
#define AO_PIN 34 //Pin esnsor di MQ2
void setup() {
  Serial.begin(9600); //Baudrate
  WiFi.begin(ssid, password); //Syarat untuk connect
  client.setInsecure();
  Serial.println("Menghubungkan ke WiFi/Jaringan..."); //Mencoba connect ke jaringan
  while (WiFi.status() != WL_CONNECTED) { //Jika belum connect
    delay(1000);
    Serial.println("Menghubungkan kembali..."); //Mencoba connect kemnbali
  }
  Serial.println("WiFi Terhubung!"); //Sudah connect
  bot.sendMessage(CHAT_ID, "✅EPS32 SUDAH ONLINE", ""); //Program sudah ONLINE
  bot.sendMessage(CHAT_ID, "🔎Pendeteksi gas otomatis", "");
  bot.sendMessage(CHAT_ID, "📌Hasil pemantauan terkini :", "");
  pinMode(AO_PIN, INPUT); //Sensor sebagai input
  pinMode(buzzer, OUTPUT); //buzzer sebagai output
  digitalWrite(buzzer, LOW); //buzzer default mati
}
void loop() {
  int nilaiGas = analogRead(AO_PIN); //membaca nilai dari sensor (Analog)
  Serial.println("Nilai gas adalah : "); //menampilkan di serial monitor
  Serial.println(nilaiGas);
  if (nilaiGas > 500) {
    bot.sendMessage(CHAT_ID, "❗❗❗PERINGATAN!, TERDETEKSI ADA GAS", ""); //mengirimkan pesan ke telegram jika ada gas terdeteksi
    Serial.println("Terdeteksi ada gas bang"); //menampilkan di serial monitor
    digitalWrite(buzzer, HIGH); //menyalakan buzzer
  } else {
    bot.sendMessage(CHAT_ID, "🔔Kondisi aman, sedang mendeteksi...", ""); //mengirimkan pesan ke telegram jika tidak ada gas terdeteksi
    Serial.println("Aman bang ga ada gas"); //menampilkan di serial monitor
    digitalWrite(buzzer, LOW); //buzzer mati
  }
  delay(3000); //pesan dikirim setiap 3 detik
}
